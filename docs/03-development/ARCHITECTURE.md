# Todal ì•„í‚¤í…ì²˜ ì„¤ê³„

> ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜, ë°ì´í„° ëª¨ë¸, ì„¤ê³„ ê²°ì •ì‚¬í•­

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Client                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  React 19       â”‚        â”‚  Client State    â”‚       â”‚
â”‚  â”‚  Components     â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Zustand)       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                           â”‚                   â”‚
â”‚          â”‚                           â–¼                   â”‚
â”‚          â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â”‚                  â”‚  Server State    â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  (React Query)   â”‚        â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Server     â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â–¼                      â”‚
â”‚  â”‚  Next.js 15     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  App Router     â”‚â—„â”€â”€â”€â”‚ API Routes      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚          â”‚                       â”‚                       â”‚
â”‚          â–¼                       â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                      â”‚
â”‚  â”‚ Server Actions  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                      â”‚
â”‚          â”‚                       â”‚                       â”‚
â”‚          â–¼                       â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Prisma ORM     â”‚    â”‚  External APIs  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚          â”‚                       â”‚                       â”‚
â”‚          â–¼                       â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Supabase       â”‚    â”‚  Google/OpenAI  â”‚            â”‚
â”‚  â”‚  (PostgreSQL)   â”‚    â”‚                 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³„ì¸µë³„ ì—­í• 

| ê³„ì¸µ | ê¸°ìˆ  | ì—­í•  |
| --- | --- | --- |
| **Presentation** | React 19 Components | UI ë Œë”ë§, ì‚¬ìš©ì ì¸í„°ë™ì…˜ |
| **State Management** | Zustand + React Query | í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ìƒíƒœ ê´€ë¦¬ |
| **API Layer** | Next.js API Routes | ì™¸ë¶€ API ì—°ë™, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |
| **Business Logic** | Server Actions | CRUD ì‘ì—…, ë°ì´í„° ë³€í™˜ |
| **Data Access** | Prisma ORM | ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ |
| **Database** | Supabase (PostgreSQL) | ë°ì´í„° ì €ì¥, ì‹¤ì‹œê°„ ê¸°ëŠ¥ |
| **Auth** | Supabase Auth | ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ |

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### ERD (Entity Relationship Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User      â”‚         â”‚   Category   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚         â”‚ id           â”‚
â”‚ email        â”‚         â”‚ userId       â”‚
â”‚ name         â”‚         â”‚ name         â”‚
â”‚ createdAt    â”‚         â”‚ color        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ order        â”‚
       â”‚                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚                        â”‚
       â”‚ 1:N              1:N   â”‚
       â”‚                        â”‚
       â–¼                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚    Todo      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚
â”‚ userId       â”‚
â”‚ categoryId   â”‚
â”‚ title        â”‚
â”‚ completed    â”‚
â”‚ parentId     â”‚â—„â”€â”
â”‚ order        â”‚  â”‚
â”‚ memo         â”‚  â”‚ Self Reference
â”‚ estimatedMin â”‚  â”‚ (ê³„ì¸µ êµ¬ì¡°)
â”‚ createdAt    â”‚  â”‚
â”‚ completedAt  â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Schedule   â”‚         â”‚   Routine    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚         â”‚ id           â”‚
â”‚ todoId       â”‚         â”‚ userId       â”‚
â”‚ startTime    â”‚         â”‚ title        â”‚
â”‚ endTime      â”‚         â”‚ categoryId   â”‚
â”‚ date         â”‚         â”‚ fixedTime    â”‚
â”‚ googleEventIdâ”‚         â”‚ daysOfWeek   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ isActive     â”‚
                         â”‚ createdAt    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Goal       â”‚         â”‚  Friend      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚         â”‚ id           â”‚
â”‚ userId       â”‚         â”‚ userId       â”‚
â”‚ categoryId   â”‚         â”‚ friendId     â”‚
â”‚ type         â”‚         â”‚ status       â”‚
â”‚ targetMinutesâ”‚         â”‚ createdAt    â”‚
â”‚ period       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ startDate    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   Activity   â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ id           â”‚
                         â”‚ userId       â”‚
                         â”‚ type         â”‚
                         â”‚ data         â”‚
                         â”‚ createdAt    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Prisma ìŠ¤í‚¤ë§ˆ

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ì‚¬ìš©ì
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  image         String?
  emailVerified DateTime?
  
  // Relations
  categories    Category[]
  todos         Todo[]
  routines      Routine[]
  goals         Goal[]
  friends       Friend[]  @relation("UserFriends")
  friendOf      Friend[]  @relation("FriendOf")
  activities    Activity[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("users")
}

// ì¹´í…Œê³ ë¦¬ (ìƒ‰ìƒ ë¼ë²¨)
model Category {
  id        String   @id @default(cuid())
  userId    String
  name      String
  color     String   // HEX color code
  order     Int      @default(0)
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  todos     Todo[]
  routines  Routine[]
  goals     Goal[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([userId, name])
  @@index([userId])
  @@map("categories")
}

// í• ì¼
model Todo {
  id            String    @id @default(cuid())
  userId        String
  categoryId    String?
  parentId      String?   // ê³„ì¸µ êµ¬ì¡°ìš©
  
  title         String
  completed     Boolean   @default(false)
  order         Int       @default(0)
  memo          String?   @db.Text
  estimatedMin  Int?      // ì˜ˆìƒ ì†Œìš”ì‹œê°„ (ë¶„)
  
  // Relations
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  category      Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  parent        Todo?     @relation("TodoHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children      Todo[]    @relation("TodoHierarchy")
  schedules     Schedule[]
  
  createdAt     DateTime  @default(now())
  completedAt   DateTime?
  updatedAt     DateTime  @updatedAt
  
  @@index([userId])
  @@index([categoryId])
  @@index([parentId])
  @@index([completed])
  @@map("todos")
}

// ì¼ì • (ìº˜ë¦°ë”ì— ë°°ì¹˜ëœ í• ì¼)
model Schedule {
  id            String    @id @default(cuid())
  todoId        String
  
  startTime     DateTime
  endTime       DateTime
  date          DateTime  // ë‚ ì§œ (ì‹œê°„ ì œì™¸)
  
  googleEventId String?   @unique // êµ¬ê¸€ ìº˜ë¦°ë” ì—°ë™ìš©
  
  // Relations
  todo          Todo      @relation(fields: [todoId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([todoId])
  @@index([date])
  @@map("schedules")
}

// ë£¨í‹´
model Routine {
  id          String   @id @default(cuid())
  userId      String
  categoryId  String?
  
  title       String
  fixedTime   String   // "09:00" í˜•ì‹
  daysOfWeek  Int[]    // [0,1,2,3,4,5,6] (ì¼~í† )
  isActive    Boolean  @default(true)
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  category    Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@index([isActive])
  @@map("routines")
}

// ëª©í‘œ (Phase 2)
model Goal {
  id            String   @id @default(cuid())
  userId        String
  categoryId    String?
  
  type          String   // "weekly" | "monthly"
  targetMinutes Int      // ëª©í‘œ ì‹œê°„ (ë¶„)
  period        String   // "2025-W42" or "2025-10"
  
  startDate     DateTime
  endDate       DateTime
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  category      Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([userId, categoryId, period])
  @@index([userId])
  @@map("goals")
}

// ì¹œêµ¬ ê´€ê³„ (Phase 5)
model Friend {
  id        String   @id @default(cuid())
  userId    String
  friendId  String
  
  status    String   @default("pending") // "pending" | "accepted" | "blocked"
  
  // Relations
  user      User     @relation("UserFriends", fields: [userId], references: [id], onDelete: Cascade)
  friend    User     @relation("FriendOf", fields: [friendId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([userId, friendId])
  @@index([userId])
  @@index([friendId])
  @@map("friends")
}

// í™œë™ ë¡œê·¸ (Phase 5 - ì†Œì…œ í”¼ë“œ)
model Activity {
  id        String   @id @default(cuid())
  userId    String
  
  type      String   // "completed_todo" | "achieved_goal" | "routine_streak"
  data      Json     // ìƒì„¸ ë°ì´í„°
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([createdAt])
  @@map("activities")
}
```

---

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### 1. í• ì¼ ìƒì„±

```
[ì‚¬ìš©ì ì…ë ¥]
    â”‚
    â–¼
[TodoInput Component] (Client)
    â”‚
    â”‚ Enter í‚¤
    â–¼
[createTodo Server Action]
    â”‚
    â–¼
[Prisma: todo.create()]
    â”‚
    â–¼
[PostgreSQL]
    â”‚
    â–¼
[revalidatePath('/')]
    â”‚
    â–¼
[React Query: invalidate]
    â”‚
    â–¼
[UI ìë™ ì—…ë°ì´íŠ¸]
```

### 2. ë“œë˜ê·¸ì•¤ë“œë¡­ (í• ì¼ â†’ ìº˜ë¦°ë”)

```
[dnd-kit onDragEnd]
    â”‚
    â–¼
[useOptimistic: ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸]
    â”‚
    â–¼
[createSchedule Server Action]
    â”‚
    â”œâ”€â–º [Prisma: schedule.create()]
    â”‚   â””â”€â–º [PostgreSQL]
    â”‚
    â””â”€â–º [Google Calendar API] (ì–‘ë°©í–¥ ì—°ë™)
        â””â”€â–º [êµ¬ê¸€ ìº˜ë¦°ë”ì— ì´ë²¤íŠ¸ ìƒì„±]
    â”‚
    â–¼
[React Query: invalidate]
    â”‚
    â–¼
[UI ìµœì¢… í™•ì •]
```

### 3. êµ¬ê¸€ ìº˜ë¦°ë” ë™ê¸°í™”

```
[ì£¼ê¸°ì  Sync (Webhook or Polling)]
    â”‚
    â–¼
[Google Calendar API: events.list()]
    â”‚
    â–¼
[ì„œë²„ì—ì„œ ë³€ê²½ì‚¬í•­ ê°ì§€]
    â”‚
    â”œâ”€â–º ìƒˆ ì´ë²¤íŠ¸ â†’ Prisma: schedule.create()
    â”œâ”€â–º ìˆ˜ì • ì´ë²¤íŠ¸ â†’ Prisma: schedule.update()
    â””â”€â–º ì‚­ì œ ì´ë²¤íŠ¸ â†’ Prisma: schedule.delete()
    â”‚
    â–¼
[PostgreSQL ì—…ë°ì´íŠ¸]
    â”‚
    â–¼
[Pusher or Server-Sent Events] (ì„ íƒ)
    â”‚
    â–¼
[í´ë¼ì´ì–¸íŠ¸ ìë™ ë¦¬í˜ì¹˜]
```

---

## ğŸ¯ ì£¼ìš” ì„¤ê³„ ê²°ì •ì‚¬í•­

### 1. ìƒíƒœ ê´€ë¦¬ ì „ëµ

| ìƒíƒœ íƒ€ì… | ë¼ì´ë¸ŒëŸ¬ë¦¬ | ì‚¬ìš©ì²˜ |
| --- | --- | --- |
| **ì„œë²„ ìƒíƒœ** | TanStack Query | í• ì¼, ì¼ì •, ë£¨í‹´ ë“± ì„œë²„ ë°ì´í„° |
| **í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ** | Zustand | UI ìƒíƒœ (ì‚¬ì´ë“œë°” ì—´ë¦¼/ë‹«í˜, ëª¨ë‹¬) |
| **í¼ ìƒíƒœ** | React Hook Form | ì…ë ¥ í¼ ê´€ë¦¬ |
| **Optimistic UI** | React 19 useOptimistic | ì²´í¬ë°•ìŠ¤, ë“œë˜ê·¸ì•¤ë“œë¡­ |

**ì´ìœ **: 
- ì„œë²„ ìƒíƒœì™€ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë¥¼ ëª…í™•íˆ ë¶„ë¦¬
- React Queryì˜ ìºì‹±/ë¦¬í˜ì¹­ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ê°ì†Œ
- useOptimisticìœ¼ë¡œ ì¦‰ê°ì ì¸ ì‚¬ìš©ì í”¼ë“œë°±

### 2. ê³„ì¸µ êµ¬ì¡° êµ¬í˜„

**Self-referencing ë°©ì‹ ì±„íƒ**

```typescript
// Todo í…Œì´ë¸”ì— parentId ì»¬ëŸ¼
model Todo {
  id       String  @id
  parentId String? // ë¶€ëª¨ í• ì¼ ID
  parent   Todo?   @relation("TodoHierarchy", fields: [parentId], references: [id])
  children Todo[]  @relation("TodoHierarchy")
}
```

**ì¥ì **:
- ë¬´ì œí•œ ê¹Šì´ ì§€ì›
- ì¿¼ë¦¬ ë‹¨ìˆœ (Prismaì˜ ì¤‘ì²© ì¿¼ë¦¬ í™œìš©)
- ìœ ì—°í•œ êµ¬ì¡° ë³€ê²½

**ë‹¨ì ** (í•´ê²°ë°©ì•ˆ):
- N+1 ë¬¸ì œ â†’ Prismaì˜ `include` ìµœì í™”
- ê¹Šì€ íŠ¸ë¦¬ ì„±ëŠ¥ â†’ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¬ê·€ ë Œë”ë§ ìµœì í™”

### 3. í• ì¼ vs ì¼ì • ë¶„ë¦¬

**ì„¤ê³„**: `Todo`ì™€ `Schedule`ì„ ë³„ë„ í…Œì´ë¸”ë¡œ ë¶„ë¦¬

```
Todo (1) â†â†’ (N) Schedule
```

**ì´ìœ **:
- í• ì¼ì€ "ë¬´ì—‡ì„ í• ì§€"
- ì¼ì •ì€ "ì–¸ì œ í• ì§€"
- í•œ í• ì¼ì„ ì—¬ëŸ¬ ì‹œê°„ëŒ€ì— ë°°ì¹˜ ê°€ëŠ¥ (ë°˜ë³µ ì‘ì—…)
- êµ¬ê¸€ ìº˜ë¦°ë” ì´ë²¤íŠ¸ì™€ 1:1 ë§¤í•‘

### 4. êµ¬ê¸€ ìº˜ë¦°ë” ì—°ë™ ë°©ì‹

**ì–‘ë°©í–¥ ë™ê¸°í™” ì „ëµ**:

1. **Todal â†’ Google**: 
   - ì¼ì • ìƒì„± ì‹œ ì¦‰ì‹œ Google Calendar API í˜¸ì¶œ
   - `googleEventId` ì €ì¥

2. **Google â†’ Todal**:
   - Webhook (Push Notification) ìš°ì„ 
   - Fallback: ì£¼ê¸°ì  Polling (5ë¶„ë§ˆë‹¤)

3. **ì¶©ëŒ í•´ê²°**:
   - `updatedAt` íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ
   - ìµœì‹  ë³€ê²½ì‚¬í•­ ìš°ì„ 

### 5. ë£¨í‹´ ìë™ ìƒì„± ë¡œì§

**ë°©ì‹**: Vercel Cron Jobs (ë¬´ë£Œ)

```typescript
// app/api/cron/generate-routines/route.ts
export async function GET() {
  // ë§¤ì¼ 00:01ì— ì‹¤í–‰
  const today = new Date()
  const activeRoutines = await prisma.routine.findMany({
    where: { isActive: true }
  })

  for (const routine of activeRoutines) {
    if (routine.daysOfWeek.includes(today.getDay())) {
      // ì˜¤ëŠ˜ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ë£¨í‹´ì´ë©´ Todo ìƒì„±
      await prisma.todo.create({...})
    }
  }
}
```

**ì„¤ì •**: `vercel.json`
```json
{
  "crons": [
    {
      "path": "/api/cron/generate-routines",
      "schedule": "1 0 * * *"
    }
  ]
}
```

### 6. ë“œë˜ê·¸ì•¤ë“œë¡­ êµ¬í˜„

**ë¼ì´ë¸ŒëŸ¬ë¦¬**: dnd-kit

**ì´ìœ **:
- ì ‘ê·¼ì„± ìš°ìˆ˜ (í‚¤ë³´ë“œ ì§€ì›)
- ì„±ëŠ¥ ìµœì í™” (Virtual DOM)
- ë‹¤ì–‘í•œ ë“œë˜ê·¸ ì‹œë‚˜ë¦¬ì˜¤ ì§€ì›

**êµ¬ì¡°**:
```typescript
<DndContext onDragEnd={handleDragEnd}>
  <Droppable id="todo-list">
    {todos.map(todo => (
      <Draggable key={todo.id} id={todo.id}>
        <TodoItem todo={todo} />
      </Draggable>
    ))}
  </Droppable>
  
  <Droppable id="calendar">
    <CalendarView />
  </Droppable>
</DndContext>
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì¸ì¦/ì¸ê°€

- **Supabase Auth** ì‚¬ìš©
- JWT ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬
- ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸, Google OAuth, ì†Œì…œ ë¡œê·¸ì¸ ì§€ì›
- Row Level Security (RLS)ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ ë³´ì•ˆ

### 2. API ë³´í˜¸

```typescript
// Server Actionì—ì„œ ì‚¬ìš©ì ê²€ì¦
import { createServerClient } from '@supabase/ssr'

export async function createTodo(data: CreateTodoInput) {
  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    // ... cookies config
  )
  
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    throw new Error('Unauthorized')
  }
  
  // userIdê°€ ì„¸ì…˜ ì‚¬ìš©ìì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
  return prisma.todo.create({
    data: {
      ...data,
      userId: user.id
    }
  })
}
```

### 3. SQL Injection ë°©ì§€

- Prisma ORMì˜ íŒŒë¼ë¯¸í„°í™”ëœ ì¿¼ë¦¬ ì‚¬ìš©
- Raw ì¿¼ë¦¬ ìµœì†Œí™”

### 4. XSS ë°©ì§€

- Reactì˜ ìë™ ì´ìŠ¤ì¼€ì´í•‘
- `dangerouslySetInnerHTML` ì‚¬ìš© ê¸ˆì§€

### 5. CSRF ë°©ì§€

- NextAuth.jsì˜ CSRF í† í° ìë™ ì²˜ë¦¬
- Server Actionsì˜ ìë™ CSRF ë³´í˜¸

---

## ğŸ“ˆ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ì‹±

```prisma
// ìì£¼ ì¿¼ë¦¬ë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤
@@index([userId])
@@index([categoryId])
@@index([completed])
@@index([date])
```

### 2. ì¿¼ë¦¬ ìµœì í™”

```typescript
// âŒ N+1 ë¬¸ì œ
const todos = await prisma.todo.findMany()
for (const todo of todos) {
  const category = await prisma.category.findUnique({
    where: { id: todo.categoryId }
  })
}

// âœ… Includeë¡œ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸°
const todos = await prisma.todo.findMany({
  include: {
    category: true,
    schedules: true
  }
})
```

### 3. ìºì‹± ì „ëµ

| ë ˆë²¨ | ë°©ë²• | TTL |
| --- | --- | --- |
| **CDN** | Vercel Edge Network | ì •ì  íŒŒì¼ |
| **Browser** | React Query | 5ë¶„ (staleTime) |
| **Server** | Next.js unstable_cache | 1ë¶„ |
| **Database** | Prisma Connection Pool | - |

### 4. Phaseë³„ í™•ì¥ ì „ëµ

- **Phase 1-2**: Vercel Hobby + Supabase Free
- **Phase 3**: Vercel Pro + Supabase Pro (í•„ìš”ì‹œ)
- **Phase 4**: AI API í˜¸ì¶œ ìµœì í™” (ìŠ¤íŠ¸ë¦¬ë°)
- **Phase 5**: Supabase Realtime + Edge Functions (ì‹¤ì‹œê°„ ê¸°ëŠ¥)

---

**Last Updated**: 2025-10-17

